#for error in 0.2; do
#for error in 0.01 0.001 0.0001 0.00001 0.000001 0.0000001 0.00000001; do
error=0.1

#for TER_ADD in 0.1 0.01 0.001 0.0001 0.00001; do 
#for TER_ADD in 0.5 0.9; do    #make up for the ICCAD paper 
for TER_ADD in 0; do     #profile the input operands for MUL and ADD  
    for TER_MUL in 0; do
        g++ -c test_fp_error_MLP.cpp -I./ -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_ADD} -DTER_MUL=${TER_MUL}
        g++ test_fp_error_MLP.o -o test_fp_error_MLP -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_ADD} -DTER_MUL=${TER_MUL}
        ./test_fp_error_MLP examples/mnist 2>&1 | tee ./DATE_report/test_fp_add_error_MLP.${TER_ADD}.log
        #./test_fp_error_MLP examples/mnist 2>&1 | tee test_fp_add_error_MLP.${TER_ADD}.log
    done 
done

<<COMMENT1
#for TER_MUL in 0.1 0.01 0.001 0.0001 0.00001; do 
for TER_MUL in 0.5 0.9; do 
    for TER_ADD in 0; do
        g++ -c test_fp_error_MLP.cpp -I./ -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_ADD} -DTER_MUL=${TER_MUL}
        g++ test_fp_error_MLP.o -o test_fp_error_MLP -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_ADD} -DTER_MUL=${TER_MUL}
        ./test_fp_error_MLP examples/mnist 2>&1 | tee test_fp_mul_error_MLP.${TER_MUL}.log
    done 
done

#for TER_both in 0.1 0.01 0.001 0.0001 0.00001; do 
for TER_both in 0.5 0.9; do 
    g++ -c test_fp_error_MLP.cpp -I./ -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_both} -DTER_MUL=${TER_both}
    g++ test_fp_error_MLP.o -o test_fp_error_MLP -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${TER_both} -DTER_MUL=${TER_both}
    ./test_fp_error_MLP examples/mnist 2>&1 | tee test_fp_both_error_MLP.${TER_both}.log
done 

#declare -a a_error=(0.99873999999999996 0.955785 0.71994000000000002 0.66175499999999998 0.59181499999999998 0.55961499999999997 0.26996500000000001 0.23081499999999999 0.0054450000000000002 0.0063850000000000001 2.0000000000000002e-05 3.0000000000000001e-05);
#declare -a m_error=(1.0 1.0 1.0 1.0 1.0 1.0 0.99802000000000002 0.99400500000000003 0.34042 0.30771999999999999 0.0026949999999999999 0.0039699999999999996);
#declare -a a_error=(0.56911 0.55659000000000003 0.51107499999999995 0.49822499999999997 0.39231500000000002 0.38264999999999999 0.23108000000000001 0.23124 0.13481000000000001 0.145315 0.059455000000000001 0.080835000000000004 0.0094599999999999997 0.016729999999999998 0.003225 0.0051000000000000004 0.00056499999999999996 0.0013799999999999999 0.0001 0.00038000000000000002);
#declare -a m_error=(0.99994499999999997 0.99978 0.99856999999999996 0.99637500000000001 0.97428000000000003 0.95857499999999995 0.80555500000000002 0.77085499999999996 0.40833999999999998 0.40544999999999998 0.12665000000000001 0.14626 0.030259999999999999 0.040094999999999999 0.0047800000000000004 0.0091850000000000005 0.00087500000000000002 0.0017849999999999999 0.000125 0.00036999999999999999);
declare -a a_error=(0.51537500000000003 0.49490000000000001 0.39526499999999998 0.37313499999999999 0.23333499999999999 0.22823499999999999 0.13284000000000001 0.13649500000000001 0.055879999999999999 0.066869999999999999 0.0072700000000000004 0.0092650000000000007 0.00199 0.0034749999999999998 0.00035 0.000745 0.000025 0.000145 0.0 0.000010000000000000001)
declare -a m_error=(0.99929500000000004 0.99787000000000003 0.98689000000000004 0.97192999999999996 0.869425 0.81547000000000003 0.49889499999999998 0.45310499999999998 0.16063 0.15989 0.037045000000000002 0.044694999999999999 0.0061549999999999999 0.0099000000000000008 0.00086499999999999999 0.001755 0.00011 0.00032000000000000003 0.0 0.000050000000000000002)
for index in 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19; do
	echo $a_error[$index]
	echo $m_error[$index]
        g++ -c test_fp_error_MLP.cpp -I./ -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${a_error[$index]} -DTER_MUL=${m_error[$index]}
        g++ test_fp_error_MLP.o -o test_fp_error_MLP -pthread -std=c++11 -DCNN_USE_GEMMLOWP=true -DCNN_REGISTER_LAYER_DESERIALIZER=true -DADDER_ERROR_RATE=${error} -DMULTI_ERROR_RATE=${error} -DTER_ADD=${a_error[$index]} -DTER_MUL=${m_error[$index]}
        ./test_fp_error_MLP examples/mnist 2>&1 | tee test_fp_vt_error_MLP.p${index}.log
done 
COMMENT1
